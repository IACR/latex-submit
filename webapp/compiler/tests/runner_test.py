import docker
import glob
import io
import json
import os
from pathlib import Path
import pytest
import shutil
import sys
import tempfile

sys.path.insert(0, '../')

from runner import run_latex

cmd = 'latexmk -g -recorder -pdf -pdflatex="pdflatex -interaction=nonstopmode -disable-write18 -no-shell-escape" main'

def test_compile1():
    with tempfile.TemporaryDirectory() as tmpdirpath:
        output_path = tmpdirpath + '/output'
        output = run_latex(cmd, '../../metadata/latex/iacrcc/tests/test1', output_path)
        assert output.get('exit_code') == 0

def test_compile2():
    with tempfile.TemporaryDirectory() as tmpdirpath:
        output_path = tmpdirpath + '/output'
        output = run_latex(cmd, '../../metadata/latex/iacrcc/tests/test2', output_path)
        assert output.get('exit_code') == 0

def test_compile3():
    with tempfile.TemporaryDirectory() as tmpdirpath:
        output_path = tmpdirpath + '/output'
        output = run_latex(cmd, '../../metadata/latex/iacrcc/tests/test3', output_path)
        assert output.get('exit_code') == 0

def test_compile4():
    with tempfile.TemporaryDirectory() as tmpdirpath:
        output_path = tmpdirpath + '/output'
        output = run_latex(cmd, '../../metadata/latex/iacrcc/tests/test4', output_path)
        assert output.get('exit_code') == 12

def test_passing():
    with tempfile.TemporaryDirectory() as tmpdirpath:
        output_path = tmpdirpath + '/output'
        output = run_latex(cmd, 'passing', output_path)
        assert output.get('exit_code') == 0

def test_failing():
    with tempfile.TemporaryDirectory() as tmpdirpath:
        output_path = tmpdirpath + '/output'
        output = run_latex(cmd, 'failing', output_path)
        assert output.get('exit_code') == 12
        
def test_packages():
    """Make sure the list of packages in the docker image is correct."""
    packages = set(["12many",
                    "a2ping",
                    "a2ping.x86_64-linux",
                    "aaai-named",
                    "abbr",
                    "abstyles",
                    "academicons",
                    "accents",
                    "accessibility",
                    "accfonts",
                    "accfonts.x86_64-linux",
                    "accsupp",
                    "acro",
                    "acronym",
                    "addliga",
                    "addtoluatexpath",
                    "adhocfilelist",
                    "adhocfilelist.x86_64-linux",
                    "adjustbox",
                    "advice",
                    "ae",
                    "aeguill",
                    "afm2pl",
                    "afm2pl.x86_64-linux",
                    "aichej",
                    "ajl",
                    "albatross",
                    "albatross.x86_64-linux",
                    "alg",
                    "algobox",
                    "algorithm2e",
                    "algorithmicx",
                    "algorithms",
                    "algpseudocodex",
                    "algxpar",
                    "aligned-overset",
                    "alphalph",
                    "amiweb2c-guide",
                    "amscdx",
                    "amscls",
                    "amscls-doc",
                    "amsfonts",
                    "amslatex-primer",
                    "amsldoc-it",
                    "amsmath",
                    "amsmath-it",
                    "amsrefs",
                    "amstex",
                    "amstex.x86_64-linux",
                    "amsthdoc-it",
                    "annee-scolaire",
                    "annotate",
                    "annotate-equations",
                    "antanilipsum",
                    "antique-spanish-units",
                    "anyfontsize",
                    "anysize",
                    "apacite",
                    "apalike-ejor",
                    "apalike-german",
                    "apalike2",
                    "apnum",
                    "appendix",
                    "apprendre-a-programmer-en-tex",
                    "apprends-latex",
                    "apptools",
                    "apxproof",
                    "arabxetex",
                    "arara",
                    "arara.x86_64-linux",
                    "archaeologie",
                    "armtex",
                    "around-the-bend",
                    "arphic",
                    "arphic-ttf",
                    "arydshln",
                    "asana-math",
                    "ascii-chart",
                    "ascii-font",
                    "ascmac",
                    "asymptote",
                    "asymptote.x86_64-linux",
                    "atbegshi",
                    "attachfile2",
                    "attachfile2.x86_64-linux",
                    "atveryend",
                    "authordate",
                    "auto-pst-pdf-lua",
                    "autoaligne",
                    "autobreak",
                    "automata",
                    "autonum",
                    "autotype",
                    "auxhook",
                    "avantgar",
                    "axessibility",
                    "axodraw2",
                    "axodraw2.x86_64-linux",
                    "babel",
                    "babel-albanian",
                    "babel-basque",
                    "babel-bosnian",
                    "babel-breton",
                    "babel-catalan",
                    "babel-croatian",
                    "babel-czech",
                    "babel-danish",
                    "babel-dutch",
                    "babel-english",
                    "babel-estonian",
                    "babel-finnish",
                    "babel-french",
                    "babel-friulan",
                    "babel-galician",
                    "babel-german",
                    "babel-greek",
                    "babel-hungarian",
                    "babel-icelandic",
                    "babel-irish",
                    "babel-italian",
                    "babel-kurmanji",
                    "babel-latin",
                    "babel-latvian",
                    "babel-lithuanian",
                    "babel-macedonian",
                    "babel-norsk",
                    "babel-occitan",
                    "babel-piedmontese",
                    "babel-polish",
                    "babel-portuges",
                    "babel-romanian",
                    "babel-romansh",
                    "babel-samin",
                    "babel-scottish",
                    "babel-slovak",
                    "babel-slovenian",
                    "babel-spanish",
                    "babel-swedish",
                    "babel-turkish",
                    "babel-welsh",
                    "babelbib",
                    "backnaur",
                    "barr",
                    "barracuda",
                    "basque-book",
                    "basque-date",
                    "bbcard",
                    "bbding",
                    "bbm",
                    "bbm-macros",
                    "bbold",
                    "beamer",
                    "beamer-tut-pt",
                    "beebe",
                    "begriff",
                    "besjournals",
                    "bestpapers",
                    "bezierplot",
                    "bib-fr",
                    "bib2gls",
                    "bib2gls.x86_64-linux",
                    "bibarts",
                    "bibcop",
                    "bibcop.x86_64-linux",
                    "biber",
                    "biber-ms",
                    "biber-ms.x86_64-linux",
                    "biber.x86_64-linux",
                    "bibexport",
                    "bibexport.x86_64-linux",
                    "bibhtml",
                    "biblatex",
                    "biblatex-abnt",
                    "biblatex-ajc2020unofficial",
                    "biblatex-anonymous",
                    "biblatex-apa",
                    "biblatex-apa6",
                    "biblatex-archaeology",
                    "biblatex-arthistory-bonn",
                    "biblatex-bath",
                    "biblatex-bookinarticle",
                    "biblatex-bookinother",
                    "biblatex-bwl",
                    "biblatex-caspervector",
                    "biblatex-cheatsheet",
                    "biblatex-chem",
                    "biblatex-chicago",
                    "biblatex-claves",
                    "biblatex-cv",
                    "biblatex-dw",
                    "biblatex-enc",
                    "biblatex-ext",
                    "biblatex-fiwi",
                    "biblatex-gb7714-2015",
                    "biblatex-german-legal",
                    "biblatex-gost",
                    "biblatex-historian",
                    "biblatex-ieee",
                    "biblatex-ijsra",
                    "biblatex-iso690",
                    "biblatex-jura2",
                    "biblatex-juradiss",
                    "biblatex-license",
                    "biblatex-lncs",
                    "biblatex-lni",
                    "biblatex-luh-ipw",
                    "biblatex-manuscripts-philology",
                    "biblatex-mla",
                    "biblatex-morenames",
                    "biblatex-ms",
                    "biblatex-multiple-dm",
                    "biblatex-musuos",
                    "biblatex-nature",
                    "biblatex-nejm",
                    "biblatex-nottsclassic",
                    "biblatex-opcit-booktitle",
                    "biblatex-oxref",
                    "biblatex-philosophy",
                    "biblatex-phys",
                    "biblatex-publist",
                    "biblatex-readbbl",
                    "biblatex-realauthor",
                    "biblatex-sbl",
                    "biblatex-science",
                    "biblatex-shortfields",
                    "biblatex-socialscienceshuberlin",
                    "biblatex-software",
                    "biblatex-source-division",
                    "biblatex-spbasic",
                    "biblatex-subseries",
                    "biblatex-swiss-legal",
                    "biblatex-trad",
                    "biblatex-true-citepages-omit",
                    "biblatex-unified",
                    "biblatex-vancouver",
                    "biblatex2bibitem",
                    "bibleref-french",
                    "bibleref-german",
                    "biblist",
                    "bibtex",
                    "bibtex.x86_64-linux",
                    "bibtex8",
                    "bibtex8.x86_64-linux",
                    "bibtexperllibs",
                    "bibtexperllibs.x86_64-linux",
                    "bibtexu",
                    "bibtexu.x86_64-linux",
                    "bibtools",
                    "bibtopic",
                    "bibtopicprefix",
                    "bibunits",
                    "bidi-atbegshi",
                    "bidicontour",
                    "bidipagegrid",
                    "bidipresentation",
                    "bidishadowtext",
                    "bigfoot",
                    "bigintcalc",
                    "binomexp",
                    "biocon",
                    "biolett-bst",
                    "bitelist",
                    "bitpattern",
                    "bitset",
                    "blindtext",
                    "blkarray",
                    "blockdraw_mp",
                    "blopentype",
                    "bodeplot",
                    "bohr",
                    "boldtensors",
                    "bookdb",
                    "bookman",
                    "bookmark",
                    "booktabs",
                    "booktabs-de",
                    "booktabs-fr",
                    "borceux",
                    "bosisio",
                    "boxedminipage",
                    "bpchem",
                    "bpolynomial",
                    "braket",
                    "breakcites",
                    "breakurl",
                    "bredzenie",
                    "breqn",
                    "bropd",
                    "bundledoc",
                    "bundledoc.x86_64-linux",
                    "businesscard-qrcode",
                    "bussproofs",
                    "bussproofs-extra",
                    "bytefield",
                    "c-pascal",
                    "cahierprof",
                    "calcfrac",
                    "calculation",
                    "calculator",
                    "calrsfs",
                    "cancel",
                    "capt-of",
                    "caption",
                    "carlisle",
                    "cartonaugh",
                    "cascade",
                    "cases",
                    "catchfile",
                    "catcodes",
                    "causets",
                    "cbfonts",
                    "cbfonts-fd",
                    "cc-pl",
                    "ccfonts",
                    "ccicons",
                    "ccool",
                    "cell",
                    "cellspace",
                    "changepage",
                    "changes",
                    "charter",
                    "chbibref",
                    "checkcites",
                    "checkcites.x86_64-linux",
                    "checklistings",
                    "checklistings.x86_64-linux",
                    "chemarrow",
                    "chembst",
                    "chemcompounds",
                    "chemcono",
                    "chemexec",
                    "chemformula",
                    "chemformula-ru",
                    "chemgreek",
                    "chemmacros",
                    "chemnum",
                    "chemobabel",
                    "chemplants",
                    "chemschemex",
                    "chemsec",
                    "chemstyle",
                    "chicago",
                    "chicago-annote",
                    "chicagoa",
                    "chicagolinks",
                    "chickenize",
                    "chinese-jfm",
                    "chklref",
                    "chklref.x86_64-linux",
                    "chktex",
                    "chktex.x86_64-linux",
                    "chngcntr",
                    "chronosys",
                    "chscite",
                    "circuitikz",
                    "citation-style-language",
                    "citation-style-language.x86_64-linux",
                    "cite",
                    "citeall",
                    "citeref",
                    "cjhebrew",
                    "cjk",
                    "cleveref",
                    "clojure-pamphlet",
                    "clojure-pamphlet.x86_64-linux",
                    "cloze",
                    "clrscode",
                    "clrscode3e",
                    "cluttex",
                    "cluttex.x86_64-linux",
                    "cm",
                    "cm-super",
                    "cm-unicode",
                    "cmap",
                    "cmarrows",
                    "cmexb",
                    "cmextra",
                    "cnbwp",
                    "cns",
                    "codeanatomy",
                    "codicefiscaleitaliano",
                    "collargs",
                    "collectbox",
                    "collection-basic",
                    "collection-bibtexextra",
                    "collection-binextra",
                    "collection-context",
                    "collection-fontsrecommended",
                    "collection-fontutils",
                    "collection-langczechslovak",
                    "collection-langenglish",
                    "collection-langeuropean",
                    "collection-langfrench",
                    "collection-langgerman",
                    "collection-langitalian",
                    "collection-langpolish",
                    "collection-langportuguese",
                    "collection-langspanish",
                    "collection-latex",
                    "collection-latexrecommended",
                    "collection-luatex",
                    "collection-mathscience",
                    "collection-metapost",
                    "collection-plaingeneric",
                    "collection-texworks",
                    "collection-xetex",
                    "collref",
                    "colorprofiles",
                    "colorsep",
                    "colortbl",
                    "combofont",
                    "commath",
                    "comment",
                    "commutative-diagrams",
                    "compactbib",
                    "compare",
                    "complexity",
                    "components",
                    "comprehensive",
                    "computational-complexity",
                    "concmath",
                    "concrete",
                    "conteq",
                    "context",
                    "context-calendar-examples",
                    "context-collating-marks",
                    "context-cyrillicnumbers",
                    "context-filter",
                    "context-gnuplot",
                    "context-handlecsv",
                    "context-legacy",
                    "context-legacy.x86_64-linux",
                    "context-letter",
                    "context-mathsets",
                    "context-notes-zh-cn",
                    "context-pocketdiary",
                    "context-simpleslides",
                    "context-squares",
                    "context-sudoku",
                    "context-texlive",
                    "context-transliterator",
                    "context-typescripts",
                    "context-vim",
                    "context-visualcounter",
                    "context.x86_64-linux",
                    "contour",
                    "correctmathalign",
                    "couleurs-fr",
                    "courier",
                    "cqubeamer",
                    "crop",
                    "crossrefenum",
                    "crossrefware",
                    "crossrefware.x86_64-linux",
                    "cryptocode",
                    "cs",
                    "csassignments",
                    "csbulletin",
                    "cslatex",
                    "csplain",
                    "csplain.x86_64-linux",
                    "csquotes",
                    "csquotes-de",
                    "cstex",
                    "cstypo",
                    "csvsimple",
                    "ctable",
                    "ctablestack",
                    "ctan-o-mat",
                    "ctan-o-mat.x86_64-linux",
                    "ctan_chk",
                    "ctanbib",
                    "ctanbib.x86_64-linux",
                    "ctanify",
                    "ctanify.x86_64-linux",
                    "ctanupload",
                    "ctanupload.x86_64-linux",
                    "ctie",
                    "ctie.x86_64-linux",
                    "currfile",
                    "cursolatex",
                    "custom-bib",
                    "cvss",
                    "cweb",
                    "cweb-old",
                    "cweb.x86_64-linux",
                    "dashbox",
                    "dashrule",
                    "datatool",
                    "datetime2",
                    "dblfloatfix",
                    "de-macro",
                    "de-macro.x86_64-linux",
                    "decision-table",
                    "dehyph",
                    "dehyph-exptl",
                    "delim",
                    "delimseasy",
                    "delimset",
                    "derivative",
                    "detex",
                    "detex.x86_64-linux",
                    "dhua",
                    "diagbox",
                    "dickimaw",
                    "diffcoeff",
                    "digestif",
                    "digestif.x86_64-linux",
                    "digiconfigs",
                    "dijkstra",
                    "din1505",
                    "dinat",
                    "dirtree",
                    "dk-bib",
                    "docbytex",
                    "doclicense",
                    "docsurvey",
                    "doipubmed",
                    "dosepsbin",
                    "dosepsbin.x86_64-linux",
                    "doublestroke",
                    "dowith",
                    "drawing-with-metapost",
                    "drawmatrix",
                    "drawstack",
                    "droit-fr",
                    "drv",
                    "dtk-bibliography",
                    "dtl",
                    "dtl.x86_64-linux",
                    "dtxgen",
                    "dtxgen.x86_64-linux",
                    "dtxtut",
                    "dutchcal",
                    "dvi2tty",
                    "dvi2tty.x86_64-linux",
                    "dviasm",
                    "dviasm.x86_64-linux",
                    "dvicopy",
                    "dvicopy.x86_64-linux",
                    "dvidvi",
                    "dvidvi.x86_64-linux",
                    "dviincl",
                    "dviinfox",
                    "dviinfox.x86_64-linux",
                    "dviljk",
                    "dviljk.x86_64-linux",
                    "dviout-util",
                    "dviout-util.x86_64-linux",
                    "dvipdfmx",
                    "dvipdfmx.x86_64-linux",
                    "dvipng",
                    "dvipng.x86_64-linux",
                    "dvipos",
                    "dvipos.x86_64-linux",
                    "dvips",
                    "dvips.x86_64-linux",
                    "dvipsconfig",
                    "dvisvgm",
                    "dvisvgm.x86_64-linux",
                    "dyntree",
                    "e-french",
                    "easing",
                    "easydtx",
                    "easydtx.x86_64-linux",
                    "ebproof",
                    "ec",
                    "ecobiblatex",
                    "econ-bst",
                    "econometrics",
                    "economic",
                    "eepic",
                    "eijkhout",
                    "ekdosis",
                    "ellipsis",
                    "eltex",
                    "emf",
                    "emoji",
                    "emojicite",
                    "emp",
                    "enctex",
                    "encxvlna",
                    "endiagram",
                    "endnotes",
                    "engtlc",
                    "enigma",
                    "enumitem",
                    "environ",
                    "eolang",
                    "eolang.x86_64-linux",
                    "epigram",
                    "epigraph",
                    "epsf",
                    "epsf-dvipdfmx",
                    "epsincl",
                    "epslatex-fr",
                    "epstopdf",
                    "epstopdf-pkg",
                    "epstopdf.x86_64-linux",
                    "eqexpl",
                    "eqnarray",
                    "eqnnumwarn",
                    "eqparbox",
                    "es-tex-faq",
                    "esint",
                    "eso-pic",
                    "esvect",
                    "etdipa",
                    "etex",
                    "etex-pkg",
                    "etexcmds",
                    "etextools",
                    "etoolbox",
                    "etoolbox-de",
                    "etoolbox-generic",
                    "euclideangeometry",
                    "euenc",
                    "euler",
                    "eulervm",
                    "euro",
                    "euro-ce",
                    "eurosym",
                    "everypage",
                    "everysel",
                    "everyshi",
                    "expex-acro",
                    "expkv-bundle",
                    "expose-expl3-dunkerque-2019",
                    "expressg",
                    "extarrows",
                    "exteps",
                    "extpfeil",
                    "extsizes",
                    "facture",
                    "faktor",
                    "fancybox",
                    "fancyhdr",
                    "fancyhdr-it",
                    "fancyref",
                    "fancyvrb",
                    "fandol",
                    "fascicules",
                    "fbs",
                    "featpost",
                    "fenixpar",
                    "feupphdteses",
                    "feynmf",
                    "feynmp-auto",
                    "fifinddo-info",
                    "fifo-stack",
                    "figbib",
                    "figflow",
                    "filecontentsdef",
                    "filehook",
                    "fileinfo",
                    "filemod",
                    "finbib",
                    "findhyph",
                    "findhyph.x86_64-linux",
                    "first-latex-doc",
                    "firstaid",
                    "fitch",
                    "fix2col",
                    "fixdif",
                    "fixlatvian",
                    "fixltxhyph",
                    "fixmath",
                    "fixme",
                    "fixpdfmag",
                    "fiziko",
                    "float",
                    "floatrow",
                    "fltpoint",
                    "fmtcount",
                    "fnspe",
                    "fntproof",
                    "font-change",
                    "font-change-xetex",
                    "fontawesome",
                    "fontawesome5",
                    "fontaxes",
                    "fontbook",
                    "fontch",
                    "fontinst",
                    "fontinst.x86_64-linux",
                    "fontinstallationguide",
                    "fontname",
                    "fontools",
                    "fontools.x86_64-linux",
                    "fonts-tlwg",
                    "fontspec",
                    "fontware",
                    "fontware.x86_64-linux",
                    "fontwrap",
                    "footbib",
                    "footnotehyper",
                    "forest-quickstart",
                    "forloop",
                    "formal-grammar",
                    "formation-latex-ul",
                    "fouridx",
                    "fp",
                    "fpl",
                    "fragmaster",
                    "fragmaster.x86_64-linux",
                    "framed",
                    "francais-bst",
                    "freealign",
                    "frenchmath",
                    "frletter",
                    "frontespizio",
                    "frpseudocode",
                    "functan",
                    "galois",
                    "garrigues",
                    "garuda-c90",
                    "gastex",
                    "gates",
                    "gbt7714",
                    "gene-logic",
                    "gensymb",
                    "gentle",
                    "geometry",
                    "german",
                    "germbib",
                    "germkorr",
                    "geschichtsfrkl",
                    "getoptk",
                    "gettitlestring",
                    "gfnotation",
                    "ghsystem",
                    "gincltex",
                    "git-latexdiff",
                    "git-latexdiff.x86_64-linux",
                    "gitinfo-lua",
                    "glosmathtools",
                    "gloss-occitan",
                    "glossaries",
                    "glossaries-extra",
                    "glossaries.x86_64-linux",
                    "glyphlist",
                    "gmp",
                    "gobble",
                    "gotoh",
                    "graphbox",
                    "graphics",
                    "graphics-cfg",
                    "graphics-def",
                    "graphics-pln",
                    "greek-fontenc",
                    "grfext",
                    "grffile",
                    "grundgesetze",
                    "gsftopk",
                    "gsftopk.x86_64-linux",
                    "gtl",
                    "gu",
                    "guide-to-latex",
                    "gustlib",
                    "gustprog",
                    "hanging",
                    "happy4th",
                    "harvard",
                    "harvmac",
                    "hatching",
                    "hausarbeit-jura",
                    "helmholtz-ellis-ji-notation",
                    "helvetic",
                    "hep",
                    "hep-bibliography",
                    "hep-graphic",
                    "hep-reference",
                    "hepnames",
                    "hepparticles",
                    "hepthesis",
                    "hepunits",
                    "here",
                    "hershey-mp",
                    "historische-zeitschrift",
                    "hlist",
                    "hologo",
                    "hook-pre-commit-pkg",
                    "hopatch",
                    "hrlatex",
                    "huaz",
                    "huffman",
                    "hulipsum",
                    "hycolor",
                    "hyperref",
                    "hyperxmp",
                    "hyperxmp.x86_64-linux",
                    "hyph-utf8",
                    "hyphen-base",
                    "hyphen-basque",
                    "hyphen-catalan",
                    "hyphen-croatian",
                    "hyphen-czech",
                    "hyphen-danish",
                    "hyphen-dutch",
                    "hyphen-english",
                    "hyphen-estonian",
                    "hyphen-finnish",
                    "hyphen-french",
                    "hyphen-friulan",
                    "hyphen-galician",
                    "hyphen-german",
                    "hyphen-hungarian",
                    "hyphen-icelandic",
                    "hyphen-irish",
                    "hyphen-italian",
                    "hyphen-kurmanji",
                    "hyphen-latin",
                    "hyphen-latvian",
                    "hyphen-lithuanian",
                    "hyphen-macedonian",
                    "hyphen-norwegian",
                    "hyphen-occitan",
                    "hyphen-piedmontese",
                    "hyphen-polish",
                    "hyphen-portuguese",
                    "hyphen-romanian",
                    "hyphen-romansh",
                    "hyphen-slovak",
                    "hyphen-slovenian",
                    "hyphen-spanish",
                    "hyphen-swedish",
                    "hyphen-turkish",
                    "hyphen-uppersorbian",
                    "hyphen-welsh",
                    "hyphenat",
                    "hyphenex",
                    "hyplain",
                    "ibrackets",
                    "icite",
                    "ieeetran",
                    "ietfbibs",
                    "iexec",
                    "ifmtarg",
                    "ifoddpage",
                    "ifplatform",
                    "ifsym",
                    "iftex",
                    "ijqc",
                    "imakeidx",
                    "impatient",
                    "impatient-fr",
                    "impnattypo",
                    "import",
                    "includernw",
                    "inconsolata",
                    "index",
                    "infwarerr",
                    "inlinebib",
                    "innerscript",
                    "inputnormalization",
                    "insbox",
                    "installfont",
                    "installfont.x86_64-linux",
                    "intcalc",
                    "interchar",
                    "interpreter",
                    "interval",
                    "intro-scientific",
                    "ionumbers",
                    "iopart-num",
                    "is-bst",
                    "isomath",
                    "isphysicalmath",
                    "itnumpar",
                    "jbact",
                    "jkmath",
                    "jknapltx",
                    "jmb",
                    "jmn",
                    "jneurosci",
                    "js-misc",
                    "jupynotex",
                    "jurabib",
                    "kanaparser",
                    "kantlipsum",
                    "karnaugh",
                    "karnaugh-map",
                    "karnaughmap",
                    "kastrup",
                    "kaytannollista-latexia",
                    "ketcindy",
                    "ketcindy.x86_64-linux",
                    "knuth-errata",
                    "knuth-hint",
                    "knuth-lib",
                    "knuth-local",
                    "knuth-pdf",
                    "koma-script",
                    "koma-script-examples",
                    "kpathsea",
                    "kpathsea.x86_64-linux",
                    "ksfh_nat",
                    "kvdefinekeys",
                    "kvmap",
                    "kvoptions",
                    "kvsetkeys",
                    "l2picfaq",
                    "l2tabu",
                    "l2tabu-english",
                    "l2tabu-french",
                    "l2tabu-italian",
                    "l2tabu-spanish",
                    "l3backend",
                    "l3experimental",
                    "l3kernel",
                    "l3packages",
                    "lacheck",
                    "lacheck.x86_64-linux",
                    "lambda-lists",
                    "langcode",
                    "lastpage",
                    "latex",
                    "latex-base-dev",
                    "latex-bin",
                    "latex-bin.x86_64-linux",
                    "latex-brochure",
                    "latex-course",
                    "latex-doc-ptr",
                    "latex-firstaid-dev",
                    "latex-fonts",
                    "latex-for-undergraduates",
                    "latex-git-log",
                    "latex-git-log.x86_64-linux",
                    "latex-graphics-companion",
                    "latex-lab",
                    "latex-papersize",
                    "latex-papersize.x86_64-linux",
                    "latex-refsheet",
                    "latex-veryshortguide",
                    "latex-via-exemplos",
                    "latex-web-companion",
                    "latex2e-help-texinfo",
                    "latex2e-help-texinfo-fr",
                    "latex2e-help-texinfo-spanish",
                    "latex2man",
                    "latex2man.x86_64-linux",
                    "latex2nemeth",
                    "latex2nemeth.x86_64-linux",
                    "latex4wp",
                    "latex4wp-it",
                    "latexbug",
                    "latexcheat",
                    "latexcheat-de",
                    "latexcheat-esmx",
                    "latexcheat-ptbr",
                    "latexconfig",
                    "latexcourse-rug",
                    "latexdiff",
                    "latexdiff.x86_64-linux",
                    "latexfileinfo-pkgs",
                    "latexfileversion",
                    "latexfileversion.x86_64-linux",
                    "latexindent",
                    "latexindent.x86_64-linux",
                    "latexmk",
                    "latexmk.x86_64-linux",
                    "latexmp",
                    "latexpand",
                    "latexpand.x86_64-linux",
                    "layaureo",
                    "layouts",
                    "lcdftypetools",
                    "lcdftypetools.x86_64-linux",
                    "lecturer",
                    "leftidx",
                    "letgut",
                    "letltxmacro",
                    "letterspacing",
                    "letterswitharrows",
                    "lettrine",
                    "libertine",
                    "librarian",
                    "lie-hasse",
                    "light-latex-make",
                    "light-latex-make.x86_64-linux",
                    "ligtype",
                    "linebreaker",
                    "lineno",
                    "lipsum",
                    "listbib",
                    "listbib.x86_64-linux",
                    "listings",
                    "listings-ext",
                    "listings-ext.x86_64-linux",
                    "listingsutf8",
                    "listofitems",
                    "lithuanian",
                    "lkproof",
                    "lm",
                    "lm-math",
                    "localloc",
                    "logicproof",
                    "logreq",
                    "longdivision",
                    "lparse",
                    "lpform",
                    "lplfitch",
                    "lshort-czech",
                    "lshort-dutch",
                    "lshort-english",
                    "lshort-estonian",
                    "lshort-finnish",
                    "lshort-french",
                    "lshort-german",
                    "lshort-italian",
                    "lshort-polish",
                    "lshort-portuguese",
                    "lshort-slovak",
                    "lshort-slovenian",
                    "lshort-spanish",
                    "lshort-turkish",
                    "lstbayes",
                    "lt3luabridge",
                    "ltablex",
                    "ltb2bib",
                    "ltxcmds",
                    "ltxfileinfo",
                    "ltxfileinfo.x86_64-linux",
                    "ltximg",
                    "ltximg.x86_64-linux",
                    "ltxmisc",
                    "lua-alt-getopt",
                    "lua-placeholders",
                    "lua-tinyyaml",
                    "lua-typo",
                    "lua-uca",
                    "lua-ul",
                    "lua-uni-algos",
                    "lua-visual-debug",
                    "lua-widow-control",
                    "luaaddplot",
                    "luabibentry",
                    "luabidi",
                    "luacas",
                    "luacensor",
                    "luacode",
                    "luacolor",
                    "luacomplex",
                    "luafindfont",
                    "luafindfont.x86_64-linux",
                    "luagcd",
                    "luahbtex",
                    "luahbtex.x86_64-linux",
                    "luahttp",
                    "luahyphenrules",
                    "luaimageembed",
                    "luaindex",
                    "luainputenc",
                    "luajittex",
                    "luajittex.x86_64-linux",
                    "luakeys",
                    "lualatex-doc-de",
                    "lualatex-math",
                    "lualatex-truncate",
                    "lualibs",
                    "lualinalg",
                    "luamathalign",
                    "luamaths",
                    "luamodulartables",
                    "luamplib",
                    "luanumint",
                    "luaoptions",
                    "luaotfload",
                    "luaotfload.x86_64-linux",
                    "luapackageloader",
                    "luaplot",
                    "luaprogtable",
                    "luaquotes",
                    "luarandom",
                    "luaset",
                    "luatex",
                    "luatex.x86_64-linux",
                    "luatex85",
                    "luatexbase",
                    "luatexko",
                    "luatextra",
                    "luatruthtable",
                    "luavlna",
                    "luaxml",
                    "lutabulartools",
                    "lwarp",
                    "lwarp.x86_64-linux",
                    "macros2e",
                    "mafr",
                    "make4ht",
                    "make4ht.x86_64-linux",
                    "makecell",
                    "makecmds",
                    "makeindex",
                    "makeindex.x86_64-linux",
                    "manfnt-font",
                    "margbib",
                    "marginfix",
                    "marginnote",
                    "marvosym",
                    "matapli",
                    "match_parens",
                    "match_parens.x86_64-linux",
                    "math-into-latex-4",
                    "mathabx",
                    "mathalpha",
                    "mathcommand",
                    "mathcomp",
                    "mathdots",
                    "mathfixs",
                    "mathlig",
                    "mathpartir",
                    "mathpazo",
                    "mathpunctspace",
                    "maths-symbols",
                    "mathsemantics",
                    "mathspec",
                    "mathtools",
                    "matlab-prettifier",
                    "matrix-skeleton",
                    "mattens",
                    "mcf2graph",
                    "mdframed",
                    "mdwtools",
                    "mecaso",
                    "medmath",
                    "membranecomputing",
                    "memdesign",
                    "memoir",
                    "memoirchapterstyles",
                    "memorygraphs",
                    "messagepassing",
                    "metafont",
                    "metafont-beginners",
                    "metafont.x86_64-linux",
                    "metago",
                    "metalogo",
                    "metaobj",
                    "metaplot",
                    "metapost",
                    "metapost-colorbrewer",
                    "metapost-examples",
                    "metapost.x86_64-linux",
                    "metatex",
                    "metatype1",
                    "metauml",
                    "mex",
                    "mex.x86_64-linux",
                    "mf2pt1",
                    "mf2pt1.x86_64-linux",
                    "mfirstuc",
                    "mflogo",
                    "mflogo-font",
                    "mflua",
                    "mflua.x86_64-linux",
                    "mfnfss",
                    "mfpic",
                    "mfpic4ode",
                    "mfware",
                    "mfware.x86_64-linux",
                    "mgltex",
                    "mhchem",
                    "mhequ",
                    "microtype",
                    "microtype-de",
                    "midnight",
                    "miller",
                    "milog",
                    "minibox",
                    "minifp",
                    "minim",
                    "minim-hatching",
                    "minim-math",
                    "minim-mp",
                    "minim-pdf",
                    "minim-xmp",
                    "mismath",
                    "mkjobtexmf",
                    "mkjobtexmf.x86_64-linux",
                    "mkpattern",
                    "mlawriter",
                    "mleftright",
                    "mmap",
                    "mnsymbol",
                    "modes",
                    "modulus",
                    "morefloats",
                    "moresize",
                    "mp3d",
                    "mparrows",
                    "mpattern",
                    "mpchess",
                    "mpcolornames",
                    "mpgraphics",
                    "mptopdf",
                    "mptopdf.x86_64-linux",
                    "mptrees",
                    "msc",
                    "multibib",
                    "multibibliography",
                    "multibibliography.x86_64-linux",
                    "multido",
                    "multiobjective",
                    "multirow",
                    "munich",
                    "mwcls",
                    "mweights",
                    "na-position",
                    "nag",
                    "naive-ebnf",
                    "namedef",
                    "namedtensor",
                    "nar",
                    "natbib",
                    "natded",
                    "nath",
                    "navigator",
                    "ncctools",
                    "nchairx",
                    "ncntrsbk",
                    "needspace",
                    "nevelok",
                    "newcastle-bst",
                    "newfloat",
                    "newpax",
                    "newsletr",
                    "newtx",
                    "newunicodechar",
                    "nextpage",
                    "nicematrix",
                    "nmbib",
                    "nodetree",
                    "nomencl",
                    "norasi-c90",
                    "notes2bib",
                    "notex-bst",
                    "noto",
                    "notomath",
                    "ntgclass",
                    "nth",
                    "ntheorem",
                    "nuc",
                    "nucleardata",
                    "numberpt",
                    "numerica",
                    "numerica-plus",
                    "numerica-tables",
                    "numprint",
                    "oberdiek",
                    "objectz",
                    "odesandpdes",
                    "odsfile",
                    "ofs",
                    "olsak-misc",
                    "oplotsymbl",
                    "optex",
                    "optex.x86_64-linux",
                    "optexcount",
                    "optexcount.x86_64-linux",
                    "ordinalpt",
                    "oscola",
                    "ot-tableau",
                    "oubraces",
                    "outerhbox",
                    "outlines",
                    "overarrows",
                    "pagesel",
                    "palatino",
                    "panneauxroute",
                    "paralist",
                    "parskip",
                    "pascaltriangle",
                    "patgen",
                    "patgen.x86_64-linux",
                    "patgen2-tutorial",
                    "path",
                    "pbox",
                    "pdf-trans",
                    "pdfarticle",
                    "pdfbook2",
                    "pdfbook2.x86_64-linux",
                    "pdfcol",
                    "pdfcolfoot",
                    "pdfcrop",
                    "pdfcrop.x86_64-linux",
                    "pdfescape",
                    "pdfextra",
                    "pdflatexpicscale",
                    "pdflatexpicscale.x86_64-linux",
                    "pdflscape",
                    "pdfmanagement-testphase",
                    "pdfmsym",
                    "pdfsync",
                    "pdftex",
                    "pdftex-quiet",
                    "pdftex-quiet.x86_64-linux",
                    "pdftex.x86_64-linux",
                    "pdftexcmds",
                    "pdftosrc",
                    "pdftosrc.x86_64-linux",
                    "pdfxup",
                    "pdfxup.x86_64-linux",
                    "penlight",
                    "penlightplus",
                    "perception",
                    "perfectcut",
                    "pfarrei",
                    "pfarrei.x86_64-linux",
                    "pfdicons",
                    "pgf",
                    "pgf-blur",
                    "pgfopts",
                    "pgfplots",
                    "philokalia",
                    "physconst",
                    "physics",
                    "physics2",
                    "physunits",
                    "pict2e",
                    "pictexsum",
                    "picture",
                    "piechartmp",
                    "pinoutikz",
                    "pitex",
                    "piton",
                    "pkfix",
                    "pkfix-helper",
                    "pkfix-helper.x86_64-linux",
                    "pkfix.x86_64-linux",
                    "pl",
                    "placeat",
                    "placeins",
                    "placeins-plain",
                    "plain",
                    "plain-doc",
                    "plainpkg",
                    "plainyr",
                    "plantuml",
                    "plipsum",
                    "plnfss",
                    "plstmary",
                    "pm-isomath",
                    "pmdraw",
                    "pnas2009",
                    "polexpr",
                    "polski",
                    "polyglossia",
                    "poormanlog",
                    "ppmcheckpdf",
                    "present",
                    "prftree",
                    "principia",
                    "printlen",
                    "proba",
                    "profcollege",
                    "proflabo",
                    "proflycee",
                    "profsio",
                    "proof-at-the-end",
                    "prooftrees",
                    "przechlewski-book",
                    "ps2eps",
                    "ps2eps.x86_64-linux",
                    "ps2pk",
                    "ps2pk.x86_64-linux",
                    "pseudo",
                    "pseudocode",
                    "psfrag",
                    "psfrag-italian",
                    "pslatex",
                    "psnfss",
                    "pspicture",
                    "psutils",
                    "psutils.x86_64-linux",
                    "ptext",
                    "ptlatexcommands",
                    "purifyeps",
                    "purifyeps.x86_64-linux",
                    "pwebmac",
                    "pxfonts",
                    "pyluatex",
                    "pythonhighlight",
                    "pythontex",
                    "pythontex.x86_64-linux",
                    "qcircuit",
                    "qpxqtx",
                    "qsharp",
                    "qtree",
                    "quantikz",
                    "quickreaction",
                    "quiver",
                    "quoting",
                    "quran-de",
                    "quran-en",
                    "r_und_s",
                    "ragged2e",
                    "random",
                    "randomlist",
                    "rank-2-roots",
                    "rbt-mathnotes",
                    "rcs",
                    "readarray",
                    "realscripts",
                    "rec-thy",
                    "refcount",
                    "relsize",
                    "repere",
                    "rerunfilecheck",
                    "resolsysteme",
                    "rest-api",
                    "resumemac",
                    "revquantum",
                    "ribbonproofs",
                    "rmathbr",
                    "roex",
                    "rojud",
                    "rotfloat",
                    "roundrect",
                    "rsc",
                    "rsfs",
                    "rsfso",
                    "ruler",
                    "runtexshebang",
                    "runtexshebang.x86_64-linux",
                    "sankey",
                    "sansmath",
                    "sasnrdisplay",
                    "sauerj",
                    "savesym",
                    "scalerel",
                    "schemata",
                    "scheme-basic",
                    "scheme-infraonly",
                    "scheme-medium",
                    "scheme-minimal",
                    "schulmathematik",
                    "scikgtex",
                    "sciposter",
                    "sclang-prettifier",
                    "scratchx",
                    "section",
                    "sectsty",
                    "seetexk",
                    "seetexk.x86_64-linux",
                    "selnolig",
                    "seminar",
                    "sepnum",
                    "seqsplit",
                    "sesamanuel",
                    "setspace",
                    "sfg",
                    "sfmath",
                    "shade",
                    "shapes",
                    "shipunov",
                    "short-math-guide",
                    "showhyphenation",
                    "showkerning",
                    "showtags",
                    "shuffle",
                    "sidecap",
                    "sidenotes",
                    "simple-resume-cv",
                    "simple-thesis-dissertation",
                    "simplebnf",
                    "simpleicons",
                    "simplekv",
                    "simpler-wick",
                    "simples-matrices",
                    "simplewick",
                    "simplified-latex",
                    "sistyle",
                    "siunits",
                    "siunitx",
                    "skmath",
                    "slideshow",
                    "sort-by-letters",
                    "soul",
                    "sourcecodepro",
                    "sourcesanspro",
                    "sourceserifpro",
                    "spacekern",
                    "spalign",
                    "spath3",
                    "spbmark",
                    "spelling",
                    "spix",
                    "spix.x86_64-linux",
                    "splines",
                    "splitbib",
                    "spverbatim",
                    "srcredact",
                    "srcredact.x86_64-linux",
                    "stackengine",
                    "stanli",
                    "statex",
                    "statex2",
                    "statistics",
                    "statistik",
                    "statmath",
                    "steinmetz",
                    "stmaryrd",
                    "stricttex",
                    "string-diagrams",
                    "stringenc",
                    "structmech",
                    "struktex",
                    "sttools",
                    "sty2dtx",
                    "sty2dtx.x86_64-linux",
                    "suanpan",
                    "subdepth",
                    "subfig",
                    "subfigure",
                    "subfiles",
                    "substances",
                    "substr",
                    "subsupscripts",
                    "subtext",
                    "supertabular",
                    "susy",
                    "svg-inkscape",
                    "svn-prov",
                    "svrsymbols",
                    "swebib",
                    "swrule",
                    "syllogism",
                    "symbol",
                    "sympycalc",
                    "sympytexpackage",
                    "synctex",
                    "synctex.x86_64-linux",
                    "synproof",
                    "systeme",
                    "t-angles",
                    "t1utils",
                    "t1utils.x86_64-linux",
                    "tablefootnote",
                    "tablor",
                    "tabto-generic",
                    "tabto-ltx",
                    "tabu",
                    "tabulary",
                    "tabvar",
                    "tamethebeast",
                    "tap",
                    "tasks",
                    "tcolorbox",
                    "tds",
                    "tdsfrmath",
                    "templates-fenn",
                    "templates-sommer",
                    "tensind",
                    "tensor",
                    "termcal-de",
                    "termmenu",
                    "tetragonos",
                    "tex",
                    "tex-ewd",
                    "tex-font-errors-cheatsheet",
                    "tex-gyre",
                    "tex-gyre-math",
                    "tex-ini-files",
                    "tex-nutshell",
                    "tex-overview",
                    "tex-ps",
                    "tex-refs",
                    "tex-virtual-academy-pl",
                    "tex-vpat",
                    "tex.x86_64-linux",
                    "tex4ebook",
                    "tex4ebook.x86_64-linux",
                    "tex4ht",
                    "tex4ht.x86_64-linux",
                    "texaccents",
                    "texaccents.x86_64-linux",
                    "texapi",
                    "texblend",
                    "texblend.x86_64-linux",
                    "texbytopic",
                    "texcount",
                    "texcount.x86_64-linux",
                    "texdate",
                    "texdef",
                    "texdef.x86_64-linux",
                    "texdiff",
                    "texdiff.x86_64-linux",
                    "texdimens",
                    "texdirflatten",
                    "texdirflatten.x86_64-linux",
                    "texdoc",
                    "texdoc.x86_64-linux",
                    "texdoctk",
                    "texdoctk.x86_64-linux",
                    "texfindpkg",
                    "texfindpkg.x86_64-linux",
                    "texfot",
                    "texfot.x86_64-linux",
                    "texinfo",
                    "texlive-common",
                    "texlive-cz",
                    "texlive-de",
                    "texlive-en",
                    "texlive-es",
                    "texlive-fr",
                    "texlive-it",
                    "texlive-msg-translations",
                    "texlive-pl",
                    "texlive-scripts",
                    "texlive-scripts-extra",
                    "texlive-scripts-extra.x86_64-linux",
                    "texlive-scripts.x86_64-linux",
                    "texlive.infra",
                    "texlive.infra.x86_64-linux",
                    "texliveonfly",
                    "texliveonfly.x86_64-linux",
                    "texloganalyser",
                    "texloganalyser.x86_64-linux",
                    "texlogfilter",
                    "texlogfilter.x86_64-linux",
                    "texlogsieve",
                    "texlogsieve.x86_64-linux",
                    "texonly",
                    "texosquery",
                    "texosquery.x86_64-linux",
                    "texplate",
                    "texplate.x86_64-linux",
                    "textcase",
                    "textgreek",
                    "textopo",
                    "textpath",
                    "textpos",
                    "texware",
                    "texware.x86_64-linux",
                    "texworks",
                    "thermodynamics",
                    "thmbox",
                    "thmtools",
                    "threeddice",
                    "threeparttable",
                    "threeparttablex",
                    "thumbpdf",
                    "thumbpdf.x86_64-linux",
                    "tie",
                    "tie.x86_64-linux",
                    "tikz-cd",
                    "tikz-qtree",
                    "tikz-timing",
                    "tikzfill",
                    "tikzmark",
                    "tikzpeople",
                    "tikzscale",
                    "times",
                    "timetable",
                    "tipa",
                    "tipa-de",
                    "tiscreen",
                    "titlepages",
                    "titlesec",
                    "tkz-euclide",
                    "tlc2",
                    "tlc3-examples",
                    "tlcockpit",
                    "tlcockpit.x86_64-linux",
                    "tlmgrbasics",
                    "tlshell",
                    "tlshell.x86_64-linux",
                    "tocbibind",
                    "tocloft",
                    "todonotes",
                    "tokcycle",
                    "tools",
                    "totcount",
                    "totpages",
                    "tpic2pdftex",
                    "tpic2pdftex.x86_64-linux",
                    "tracklang",
                    "translation-array-fr",
                    "translation-arsclassica-de",
                    "translation-biblatex-de",
                    "translation-chemsym-de",
                    "translation-dcolumn-fr",
                    "translation-ecv-de",
                    "translation-enumitem-de",
                    "translation-europecv-de",
                    "translation-filecontents-de",
                    "translation-moreverb-de",
                    "translation-natbib-fr",
                    "translation-tabbing-fr",
                    "translations",
                    "translator",
                    "transparent",
                    "transparent-io",
                    "tree-dvips",
                    "treetex",
                    "trigonometry",
                    "trimspaces",
                    "truncate",
                    "truthtable",
                    "tsvtemplate",
                    "ttfutils",
                    "ttfutils.x86_64-linux",
                    "turabian-formatting",
                    "turkmen",
                    "turnstile",
                    "txfonts",
                    "typehtml",
                    "typeoutfileinfo",
                    "typeoutfileinfo.x86_64-linux",
                    "typewriter",
                    "ucharcat",
                    "ucharclasses",
                    "udesoftec",
                    "uhc",
                    "uhrzeit",
                    "ulem",
                    "ulqda",
                    "ulqda.x86_64-linux",
                    "umlaute",
                    "undergradmath",
                    "underscore",
                    "uni-wtal-ger",
                    "uni-wtal-lin",
                    "unicode-bidi",
                    "unicode-data",
                    "unicode-math",
                    "unimath-plain-xetex",
                    "uninormalize",
                    "uniquecounter",
                    "unisugar",
                    "units",
                    "unitsdef",
                    "upca",
                    "upmendex",
                    "upmendex.x86_64-linux",
                    "upquote",
                    "url",
                    "urlbst",
                    "urlbst.x86_64-linux",
                    "urwchancal",
                    "usebib",
                    "utf8mex",
                    "utopia",
                    "vak",
                    "variations",
                    "varisize",
                    "varwidth",
                    "venn",
                    "verbatimbox",
                    "verifica",
                    "version",
                    "visualfaq",
                    "visualfaq-fr",
                    "visualtikz",
                    "vlna",
                    "vlna.x86_64-linux",
                    "voss-mathcol",
                    "wadalab",
                    "was",
                    "wasy",
                    "wasy-type1",
                    "wasysym",
                    "web",
                    "web.x86_64-linux",
                    "webguide",
                    "windycity",
                    "witharrows",
                    "wrapfig",
                    "xargs",
                    "xcite",
                    "xcolor",
                    "xdvi",
                    "xdvi.x86_64-linux",
                    "xebaposter",
                    "xechangebar",
                    "xecolor",
                    "xecyr",
                    "xeindex",
                    "xelatex-dev",
                    "xelatex-dev.x86_64-linux",
                    "xesearch",
                    "xespotcolor",
                    "xetex",
                    "xetex-itrans",
                    "xetex-pstricks",
                    "xetex-tibetan",
                    "xetex.x86_64-linux",
                    "xetexconfig",
                    "xetexfontinfo",
                    "xetexko",
                    "xetexref",
                    "xevlna",
                    "xfor",
                    "xfrac",
                    "xifthen",
                    "xii",
                    "xii-lat",
                    "xindex",
                    "xindex.x86_64-linux",
                    "xindy",
                    "xindy.x86_64-linux",
                    "xintsession",
                    "xkeyval",
                    "xlop",
                    "xltxtra",
                    "xpatch",
                    "xpdfopen",
                    "xpdfopen.x86_64-linux",
                    "xstring",
                    "xunicode",
                    "xurl",
                    "xymtex",
                    "xypic",
                    "xypic-tut-pt",
                    "yamlvars",
                    "yax",
                    "yet-another-guide-latex2e",
                    "yfonts",
                    "yhmath",
                    "youngtab",
                    "yquant",
                    "ytableau",
                    "zapfchan",
                    "zapfding",
                    "zbmath-review-template",
                    "zootaxa-bst",
                    "zref",
                    "zx-calculus",
                    "zztex"])
    client = docker.from_env()
    container = client.containers.run('debian-slim-texlive',
                                      detach=True,                  # Detach the container
                                      network_disabled=False)
    # This command does _not_ expose all of the packages that are installed,
    # because some are installed as part of a group. Examples include afterpage
    # and longtable, which are both installed as part of the "tools" package.
    cmd = 'tlmgr list --only-installed --data name'
    code, stream = container.exec_run(cmd, stream=True)
    buf = ''
    for part in stream:
        buf += part.decode()
    container.kill()
    lines = set(buf.splitlines())
    diffs = packages.difference(lines)
    print(diffs)
    assert len(diffs) == 0
