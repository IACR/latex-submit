{% include "base_header.html" %}
{#
=================================================================
This template is used to show the status of a compilation.
=================================================================
#}
<h3 class="mt-2 mb-3">{{status}}</h3>
<nav>
    <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <button class="nav-link active" id="nav-log-tab" data-bs-toggle="tab" data-bs-target="#nav-log"
          type="button" role="tab" aria-controls="nav-log" aria-selected="true">Compilation log</button>
        {% if date %}
        <button class="nav-link" id="nav-meta-tab" data-bs-toggle="tab" data-bs-target="#nav-meta"
          type="button" role="tab" aria-controls="nav-meta" aria-selected="false">Output</button>
        {% endif %}
    </div>
</nav>
<div class="tab-content pt-3" id="nav-tabContent" style="overflow-y: scroll;height:80vh;background-color:#ffffff;">
  <div class="tab-pane fade show active p-3" id="nav-log" role="tabpanel" aria-labelledby="nav-log-tab">
    {% if code == 0 and pdf %}
      {% if metadata %}
      <div class="alert alert-success">It appears that your compilation worked. <a href="/pdf/{{paperid}}/main.pdf" target="_blank">View PDF</a></div>
      {% else %}
      <div class="alert alert-warning">It appears that your paper compiled, but did not use <span class="text-monospace">\documentclass{iacrcc.cls}</span></div>
      {% endif %}
    {% else %}
      <div class="alert alert-danger">Your upload did not compile. <a href="#" onclick="scrollToError();return false;">view error</a></div>
    {% endif %}
  <pre>{{log}}</pre>
  <div id="endOfOutput">{% if pdf %}<a href="/pdf/{{paperid}}/main.pdf" target="_blank">View PDF</a>{% endif %}</div>
    </div>
    {% if pdf %}
    <div class="tab-pane fade" id="nav-pdf" role="tabpanel" aria-labelledby="nav-pdf-tab">
      <embed src="/pdf/{{paperid}}/main.pdf" width="100%" height="1400px"></embed>
    </div>
    {% endif %}
    {% if date %}
    <div class="tab-pane fade" id="nav-meta" role="tabpanel" aria-labelledby="nav-meta-tab">
      <div class="row">
        <div class="col-6">
          {% if pdf %}<h3 class="ms-3 mt-3"><a href="/pdf/{{paperid}}/main.pdf" target="_blank">View PDF</a></h3>{% endif %}
          <table class="table ms-3 mt-2 table-bordered">
            <tbody>
              <tr>
                <th>Date compiled:</th>
                <td>{{date}}</td>
              </tr>
              <tr>
                <th>Compilation time:</th>
                <td>{{execution_time}} seconds</td>
              </tr>
              <tr>
                <th>Return code from latexmk:</th>
                <td>{{code}} {% if code == 0 %}(success){% endif %}</td>
              </tr>
            </tbody>
          </table>
          <div class="ms-3">
            {% if output %}
            Output files from running latexmk: (<a href="/output/{{paperid}}">download zip file</a>)
            <ul style="list-style: '-';">
              {% for el in output recursive %}
              <li>{{el.name}}
                {% if el.children %}<ul style="list-style: '-';">{{ loop(el.children) }}</ul>{% endif %}</li>
              {% endfor %}
            </ul>
            {% endif %}
          </div>
        </div>
        <div class="col-6">
          <h3 class="ms-3">Extracted metadata</h3>
          {% if metadata %}
          <pre>{{metadata}}</pre>
          {% else %}
          <div class="alert alert-danger mx-4">No metadata! Are you sure you used the <span class="text-monospace">iacrcc</span> document class?</div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}
</div>
<script>
 function scrollToError() {
   document.getElementById('endOfOutput').scrollIntoView({
     behavior: 'smooth',
     block: 'nearest',
     inline: 'start'});
 }
</script>

{% include "base_footer.html" %}
